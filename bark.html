<div style="height: 800px">
    <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>

<a href="bark.html">[  home  ]</a>
<a href="bark.html?offset=86400">[  24h  ]</a>
<a href="bark.html?offset=129600">[  12h  ]</a>
<a href="bark.html?offset=158400">[   4h  ]</a>
<a href="bark.html?offset=169200">[   1h  ]</a>
<br/>
<a href="bark.html?file=bark_chromebook.json">[  chromebook  ]</a>
<a href="bark.html?file=bark_chromebook.json&offset=86400">[  24h  ]</a>
<a href="bark.html?file=bark_chromebook.json&offset=129600">[  12h  ]</a>
<a href="bark.html?file=bark_chromebook.json&offset=158400">[   4h  ]</a>
<a href="bark.html?file=bark_chromebook.json&offset=169200">[   1h  ]</a>
<br/>

<script type="module">
  const params = new URLSearchParams(window.location.search);
  const filename = params.get("file") || "./bark_data.json"
  const time_offset = parseInt(params.get("offset") || "0");
  const { default: bark_data} = await import(filename, {with: {type: 'json'}});
  console.log(bark_data)
  console.log(window.location)
  const ctx = document.getElementById('myChart');
  const labels = bark_data["labels"];
  var date_string = function(value){
    var date = new Date(value * 1000);
    return date.toString();
  };
  const data = {
    labels: labels,
    datasets: [{
      label: 'Chip Last update:' + date_string(bark_data["now"]),
      data: bark_data["barks"],
      fill: false,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
    }]
  };
  var time_string = function(value, with_sec){
    var date = new Date(value * 1000);
    // Hours part from the timestamp
    var hours = date.getHours();

    // Minutes part from the timestamp
    var minutes = "0" + date.getMinutes();

    // Seconds part from the timestamp
    var seconds = "0" + date.getSeconds();

    // Will display time in 10:30:23 format
    var out = hours + 'h' + minutes.substr(-2)
    if(with_sec){
       out+= ':' + seconds.substr(-2);
     }
     return out;
  };
  new Chart(ctx,{
    type: 'bubble',
    data: data,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        zoom: {
          pan: {
            enabled: true,
            scaleMode: "xy",
          },
          limits: {
          },
          zoom: {
            wheel: {
              enabled: true,
            },
            pinch: {
              enabled: true,
            },
            scaleMode: "xy",
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return time_string(context.parsed.x, true);
            }
          }
        }
      },
      scales: {
        x: {
          min: bark_data["min"] + time_offset,
          max: bark_data["max"],
          ticks: {
            count: 13,
            callback: function(value, index, ticks) {
              return time_string(value, false);
            }
          }
        }
      },
    }
  });
  /*
  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      scales: {
        x: {
          suggestedMin: 0,
          suggestedMax: 20,
          },
        y: {
          suggestedMin: 0,
          suggestedMax: 4000,
        }
      },
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: 'Bark monitor chart'
        }
      }
    }
  });
  */
</script>

